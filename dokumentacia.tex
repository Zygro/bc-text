\chapter{Dokumentácia}
\label{kap:doc}
V tejto kapitole sa pozrieme na našu implementáciu návrhu portálu. Oboznámime sa
s modelmi, pohľadmi a niektorými funkciami a ich konkrétnymi možnosťami a použitím.
\section{Modely}
\label{modely}
Django servery sledujú návrhový vzor Model-View-Controller (MVC), kde model je tabuľka
databázy a view je spôsob zobrazenia (napríklad vo forme HTML stránky). Pre pochopenie
funkcionality je dôležité vedieť aké modely a pohľady používame a ako medzi sebou interagujú,
preto sa s nimi oboznámime.

Tu sa oboznámime s dôležitými modelmi, teda tabuľkami databázy.
Pri každom modeli spomenieme jeho názov v implementácii a slovenský ekvivalent tohto názvu.
\subsection{Lesson - úloha}
\label{doc:lesson}
Úlohy majú tieto polia:
\begin{itemize}
\itemsep0em
\item \textbf{name}: meno úlohy ktoré sa zobrazuje používateľovi.
\item \textbf{problem}: znenie úlohy.
\item \textbf{pub\_date}: dátum publikácie úlohy.
\item \textbf{number}: úroveň úlohy, používateľ musí mať vyriešené všetky povinné úlohy s
  na nižších úrovniach aby mal k tejto úlohe prístup.
\item \textbf{optional}: voliteľnosť úlohy. Povinné aj voliteľné úlohy sa odomykajú rovnako, voliteľné
   ale neodomykajú neskoršie úlohy.
\item \textbf{inputs}: vstupy na ktorých prebieha testovanie úlohy.
\item \textbf{correct\_solution}: správne riešenie, oproti ktorému sa budú testovať používateľské
   riešenia.
\end{itemize}

Pridávanie úloh je jednoduché - stačí vyplniť polia v administrátorskom prostredí
a uložiť. Na každej úrovni ale musí byť práve jedna povinná úloha, preto po upravení
alebo pridaní novej povinnej úlohy sa nasledovným spôsobom upraví poradie
(funkcia sa zavolá signálom post\_save, ktorý sa vykoná po uložení úlohy a nerobí
rozdiel medzi pridávaním novej a upravovaním starej):

Najprv sa všetky povinné úlohy posunú tak, aby neboli žiadne medzery v poradí.
Potom všetky povinné úlohy čo majú úroveň väčšiu alebo rovnú úrovni upravovanej/pridanej
úlohy sú posunuté o jednu úroveň vyššie (upravovaná/pridaná úloha nie je posunutá).
Potom sú všetky úlohy znovu posunuté tak aby neboli medzery (pre prípad, že administrátor
urobil chybu a pridal úlohu s číslom väčším ako má byť najvyššia úroveň, napríklad
ak je 6 povinných úloh a novej úlohe zadá úroveň 10).

Na úlohy máme tri rôzne pohľady (views): Jeden ktorý vráti všetky úrovne, voliteľnosti a názvy úloh ku ktorým má
používateľ prístup, druhý meno, znenie a úroveň s voliteľnosťou jednej úlohy a tretí
iba vstupy alebo skript na stiahnutie (ak používame testovač \ref{testovac1} alebo \ref{testovac2})

\subsection{Submit - riešenie}
Riešenie ktoré používateľ pošle na server na otestovanie.

Polia:
\begin{itemize}
\item \textbf{user}: používateľ ktorý riešenie poslal
\item \textbf{lesson}: úloha ktorú používateľ rieši týmto riešením
\item \textbf{submittedFile}: súbor s riešením, ktoré bude odovzdané testovaču
\item \textbf{result}: výsledok - pravda ak bolo riešenie správne, nepravda ak nebolo
\end{itemize}

Hneď ako server dostane nové riešenie, spustí testovač a jeho odpoveď uloží v poli
\textbf{result}. Ak nie je správne, riešenie uložíme a pokračujeme v činnosti ako pred jeho poslaním.
Ak testovač ale vyhodnotí riešenie ako správne, pred jeho uložením zvýši používateľovu
úroveň o 1 (ak je úloha povinná) a označí úlohu ako vyriešenú v modeli \textbf{UserLessonWrapper} (\ref{modelWrapper}).

\subsection{Comment - komentár}
Komentár od používateľa na úlohu.
Polia:
\begin{itemize}
\item \textbf{user}: používateľ ktorý vytvoril komentár
\item \textbf{lesson}: úloha ku ktorej bol komentár pridaný
\item \textbf{text}: text komentára
\item \textbf{date}: čas vytvorenia komentára, potrebný na zoraďovanie pri zobrazení
\end{itemize}

Pri komentároch sa bude zobrazovať aj úroveň autora a to, či úlohu vyriešil.
Zatiaľ sú všetky komentáre prístupné všetkým používateľom (ak majú prístup k ich úlohe)


\subsection{Hint - rada}
Rada k úlohe, pre prípad že ju používateľ nevie riešiť.

Polia:
\begin{itemize}
\item \textbf{lesson}: úloha ku ktorej je táto rada
\item \textbf{number}: poradové číslo rady
\item \textbf{text}: text rady
\end{itemize}

Používateľovi sa pri zobrazení úlohy ukazujú iba toľko rád koľko si požiadal. Táto
informácia sa ukladá v modeli \textbf{UserLessonWrapper} (\ref{modelWrapper}).
Používateľ môže požiadať o ďalšiu radu a kým existuje nepoužitá rada, zväčšíme
číslo použitých rád v \textbf{UserLessonWrapper}-i a odpovieme novým, o jednu randu dlhším zoznamom rád.

\subsection{Rating - hodnotenie}
Hodnotenie úlohy v kategóriach zložitosti a zábavnosti.

Polia:
\begin{itemize}
\item \textbf{user}: používateľ ktorý zaslal toto hodnotenie
\item \textbf{lesson}: úloha ktorú hodnotil
\item \textbf{fun}: hodnotenie zaujímavosti
\item \textbf{difficulty}: hodnotenie zložitosti
\end{itemize}

Pre každú dvojicu \textbf{úloha-používateľ} môže existovať iba jedno hodnotenie,
čo znamená že každý používateľ môže ohodnotiť každú úlohu iba raz.

Kým používateľ nevyriešil úlohu, prehliadač mu nezobrazí formulár na hodnotenie,
preto by nemal mať spôsob ako poslať hodnotenie úlohy ktorú nevyriešil.
Napriek tomu, zavedieme opatrenie proti
možnosti manuálne poslať požiadavku a tým obísť podmienku správneho vyriešenia úlohy:
pred uložením hodnotenia overíme aj na servri či používateľ úlohu správne vyriešil.
Ak a mu to ešte nepodarilo, ako odpoveď na poslanie hodnotenia dostane chybu UNAUTHORIZED.

 Ak sa mu ale podarilo úlohu predtým
vyriešiť, vytvoríme nové alebo upravíme existujúce hodnotenie a obnovíme model \textbf{LessonStat} (\ref{modelLessonStat})
aby mal aktuálne dáta.
\subsection{LessonStat - štatistika úlohy}
\label{modelLessonStat}
Model ktorý zbiera štatistické dáta o úlohe, ktoré budú neskôr spracované a ukázané administrátorovi.
K tomuto modelu má prístup iba administrátor.

Polia:
\begin{itemize}
\item \textbf{lesson}: úloha ku ktorej štatistika patrí
\item \textbf{avg\_fun}: priemerné hodnotenie zaujímavosti
\item \textbf{avg\_diff}: priemerné hodnotenie zložitosti
\item \textbf{good\_solutions}: počet používateľov ktorí úlohu správne vyriešili
  (nie počet správnych riešení, pretože účelom tohto poľa je pomôcť zistiť koľko riešení
  používatelia skúšajú pred správnym vyriešením)
\item \textbf{bad\_solutions}: počet zlých riešení úlohy pred správnym vyriešením úlohy
\end{itemize}

\subsection{UserStat - štatistika používateľa}
\label{modelWrapper}
V momentálnej implementácii zbierame iba jeden údaj pre používateľov, ktorý ale používame
na zisťovanie, ktoré úlohy používateľovi sprístupniť. Narozdiel od modelu \textbf{LessonStat} (\ref{modelLessonStat}),
táto štatistika je prístupná používateľovi a aj ostatným používateľom, ak je ochotný zverejniť svoje
meno v rebríčku (\ref{score})

Polia:
\begin{itemize}
\item \textbf{user}: používateľ
\item \textbf{progress}: úroveň používateľa - počet správne vyriešených povinných úloh
\end{itemize}

\subsection{UserLessonWrapper - obal používateľ-úloha}
Model na určovanie postupu používateľa jednou úlohou. Používa sa iba na vnútorné
overovanie prístupu používateľa k niektorým modelom. Tento model je unikátny pre ka

Polia:
\begin{itemize}
\item \textbf{user}: používateľ
\item \textbf{lesson}: úroveň používateľa - počet správne vyriešených povinných úloh
\item \textbf{hints\_used}: počet použitých rád k úlohe
\item \textbf{completed}: či používateľ správne vyriešil úlohu
\end{itemize}

Tento model sprístupníme administrátorovi na upravovanie, pretože chceme mať možnosť
opravovať nepredvídané chyby (napríklad ak používateľ pošle správne riešenie ale
úloha sa mu neoznačí za vyriešenú).
